var Team,startGame;Team={RED:0,BLU:1,NIL:2,BAD:3};Team.next=function(team){switch(team){case Team.RED:return Team.BLU;case Team.BLU:return Team.RED;default:throw Error("Invalid team ID")}};Team.word=function(team){switch(team){case Team.RED:return"Rojo";case Team.BLU:return"Azul";case Team.BAD:return"Asesino";case Team.NIL:return"Inocente";default:throw Error("Invalid team ID")}};Team.color=function(team){switch(team){case Team.RED:return"hsl(0,   100%, 37%)";case Team.BLU:return"hsl(200, 90%,  37%)";default:throw Error("Invalid team ID")}};startGame=function(restart){var computeChecksum,firstTeam,makeAgents,readConfigFromHash,setHash,teamAtTurn;firstTeam=Team.NIL;teamAtTurn=function(n){if(n%2===0){return firstTeam}else{return Team.next(firstTeam)}};makeAgents=function(words){var agents,i,indexes,j,k,l,len,len1,len2,m,newAgent,ref,ref1,ref2,results,word;newAgent=function(word){return{word:word,team:Team.NIL}};agents=function(){var j,len,ref,results;ref=d3.shuffle(words).slice(0,25);results=[];for(j=0,len=ref.length;j<len;j++){word=ref[j];results.push(newAgent(word))}return results}();indexes=d3.shuffle(function(){results=[];for(j=0;j<=24;j++){results.push(j)}return results}.apply(this));ref=indexes.splice(0,8);for(k=0,len=ref.length;k<len;k++){i=ref[k];agents[i].team=firstTeam}ref1=indexes.splice(0,7);for(l=0,len1=ref1.length;l<len1;l++){i=ref1[l];agents[i].team=Team.next(firstTeam)}ref2=indexes.splice(0,1);for(m=0,len2=ref2.length;m<len2;m++){i=ref2[m];agents[i].team=Team.BAD}return agents};computeChecksum=function(seed){var i,j,ref,sum;sum=0;for(i=j=0,ref=seed.length;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){sum+=seed.charCodeAt(0)}sum%=1009;return sum};readConfigFromHash=function(hash){var checksum,ref,seed,sum;ref=hash.split("/+").filter(function(s){return s!==""}),seed=ref[0],checksum=ref[1];if(seed!=null||seed===""){seed=decodeURIComponent(seed).toLowerCase().replace(/[^a-z]/g,"");sum=computeChecksum(seed)}return{spymaster:checksum!=null&&sum===parseInt(checksum,10),seed:seed}};setHash=function(hash){var cb;cb=window.onhashchange;window.onhashchange=null;return window.location.hash=hash};return d3.text("words/words.es.txt",function(err,text){var agents,bare_seed,cards,config,hash_seed,telegram_url,words;if(err!=null){throw err}words=text.split("\n");config=readConfigFromHash(window.location.hash.slice(1));if(restart||config.seed==null){config.spymaster=true;bare_seed=d3.shuffle(words).slice(0,3);config.seed=bare_seed.join("").toLowerCase().replace(/[^a-z]/g,"");hash_seed=encodeURIComponent(bare_seed.join("-"));setHash("#"+hash_seed+"/+"+computeChecksum(config.seed))}Math.seedrandom(config.seed);telegram_url=encodeURIComponent(location.origin+location.pathname+"#"+config.seed);d3.select(".telegram").attr("href","https://telegram.me/share/url?url="+telegram_url);firstTeam=Math.random()>.5?Team.RED:Team.BLU;d3.select(".header h1").style("text-decoration-color",Team.color(firstTeam)).style("-webkit-text-decoration-color",Team.color(firstTeam)).style("text-shadow","0 1px 2px "+Team.color(firstTeam));agents=makeAgents(words);cards=d3.selectAll(".card").data(agents).classed("red",function(a){return a.team===Team.RED}).classed("blu",function(a){return a.team===Team.BLU}).classed("bad",function(a){return a.team===Team.BAD}).style("transform","rotateY(360)").style("opacity",1);if(config.spymaster){cards.select(".front > .label").text(function(a){return a.word});cards.select(".back  > .label").text(function(a){return Team.word(a.team)});cards.style("transform","rotateY(180deg)");return cards.on("click",function(w){return d3.select(this).transition().style("opacity",.3).style("cursor","default")})}else{cards.select(".front > .label").text(function(a){return Team.word(a.team)});cards.select(".back  > .label").text(function(a){return a.word});return cards.on("click",function(w){return d3.select(this).style("transform","rotateY(180deg)")})}})};startGame();window.onhashchange=function(){return startGame()};