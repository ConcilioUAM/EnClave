var game,nextTeam,startGame,teamAtTurn,teamWord;game={starting:"nil",blu:{selections:[],points:0},red:{selections:[],points:0}};nextTeam=function(team){switch(team){case"red":return"blu";case"blu":return"red";default:throw Error("Invalid team")}};teamWord=function(team){switch(team){case"red":return"Rojo";case"blu":return"Azul";case"bad":return"Asesino";case"nil":return"Inocente";default:throw Error("Invalid team")}};teamAtTurn=function(n){if(n%2===0){return game.starting}else{return nextTeam(game.starting)}};startGame=function(){return d3.text("words/words.es.txt",function(err,text){var agent_id,agent_ids,cards,is_master,j,k,len,results,turn_number,url,word,words,words_raw;words_raw=d3.csvParseRows(text,function(a){return a[0]});is_master=location.search;if(window.location.hash===""){window.location.hash="#"+d3.shuffle(words_raw).slice(0,3).join("-")}else{window.location.hash.replace(/%20|\s/g,"-")}Math.seedrandom(decodeURIComponent(window.location.hash).toLowerCase().replace(/[^a-z]/g,""));url=encodeURIComponent(location.origin+location.pathname+location.hash);console.log(url);d3.select(".telegram").attr("href","https://telegram.me/share/url?url="+url);game.starting=Math.random()>.5?"red":"blu";words=function(){var j,len,ref,results;ref=d3.shuffle(words_raw).slice(0,25);results=[];for(j=0,len=ref.length;j<len;j++){word=ref[j];results.push({word:word,team:"nil"})}return results}();agent_ids=d3.shuffle(function(){results=[];for(j=0;j<=24;j++){results.push(j)}return results}.apply(this)).slice(0,16);for(turn_number=k=0,len=agent_ids.length;k<len;turn_number=++k){agent_id=agent_ids[turn_number];words[agent_id].team=teamAtTurn(turn_number)}words[agent_ids[15]].team="bad";cards=d3.selectAll(".card").data(words).classed("red",function(w){return w.team==="red"}).classed("blu",function(w){return w.team==="blu"}).classed("bad",function(w){return w.team==="bad"});if(is_master){cards.select(".front > .label").text(function(w){return w.word});cards.transition().delay(function(_,i){return i*10}).on("end",function(){return d3.select(this).classed("flip",true)})}else{cards.select(".back").text(function(w){return w.word});cards.select(".front > .label").text(function(w){return teamWord(w.team)})}return cards.on("click",function(w){return d3.select(this).classed("flip",!is_master)})})};window.onhashchange=startGame;startGame();