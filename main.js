var Game,Team,setHash,toggleOptions;Team={RED:0,BLU:1,NIL:2,BAD:3};Team.next=function(team){switch(team){case Team.RED:return Team.BLU;case Team.BLU:return Team.RED;default:throw RangeError("Invalid team ID")}};Team.word=function(team){switch(team){case Team.RED:return"Rojo";case Team.BLU:return"Azul";case Team.BAD:return"Asesino";case Team.NIL:return"Inocente";default:throw RangeError("Invalid team ID")}};Team.color=function(team){switch(team){case Team.RED:return"hsl(0,   100%, 37%)";case Team.BLU:return"hsl(200, 90%,  37%)";default:throw RangeError("Invalid team ID")}};Game={spymaster:false,seed:null,firstTeam:Team.NIL};Game.teamAtTurn=function(n){if(n%2){return Game.firstTeam}else{return Team.next(Game.firstTeam)}};Game.makeAgents=function(words){var agents,i,indexes,j,k,l,len,len1,len2,m,newAgent,ref,ref1,ref2,results,word;newAgent=function(word){return{word:word,team:Team.NIL}};agents=function(){var j,len,ref,results;ref=d3.shuffle(words).slice(0,25);results=[];for(j=0,len=ref.length;j<len;j++){word=ref[j];results.push(newAgent(word))}return results}();indexes=d3.shuffle(function(){results=[];for(j=0;j<=24;j++){results.push(j)}return results}.apply(this));ref=indexes.splice(0,8);for(k=0,len=ref.length;k<len;k++){i=ref[k];agents[i].team=Game.firstTeam}ref1=indexes.splice(0,7);for(l=0,len1=ref1.length;l<len1;l++){i=ref1[l];agents[i].team=Team.next(Game.firstTeam)}ref2=indexes.splice(0,1);for(m=0,len2=ref2.length;m<len2;m++){i=ref2[m];agents[i].team=Team.BAD}return agents};Game.readConfig=function(){var hash,item,j,key,len,query,ref,ref1,seed,val;hash=window.location.hash.slice(1);seed=decodeURIComponent(hash).toLowerCase();query={};ref=location.search.slice(1).split("&");for(j=0,len=ref.length;j<len;j++){item=ref[j];ref1=item.split("="),key=ref1[0],val=ref1[1];query[key]=val}return{spymaster:"spymaster"in query,seed:seed||null,query:query,hash:hash}};setHash=function(hash){console.log(window.location.pathname+"#"+hash.replace(/\s+/g,"-"));return history.replaceState(null,"",window.location.pathname+"#"+hash.replace(/\s+/g,"-"))};Game.words=new Promise(function(resolve,reject){return d3.text("words/words.es.txt",function(err,text){if(err!=null){reject(err)}return resolve(text.split("\n"))})});Game.start=function(seed,spymaster){return Game.words.then(function(words){var agents,cards;words=words.slice(0);if(seed==null||seed===""){seed=d3.shuffle(words.slice(0)).slice(0,3).join("-");spymaster=true}Game.seed=seed;Game.spymaster=spymaster;Math.seedrandom(Game.seed.replace(/[^a-z]/g,""));setHash(Game.seed);document.getElementById("seed").value=Game.seed.replace(/[^\wÃ±]+/g," ");document.querySelector("a.telegram").href="https://telegram.me/share/url?url="+encodeURIComponent(window.location);Math.seedrandom(Game.seed.replace(/[^a-z]/g,""));Game.firstTeam=Math.random()>.5?Team.RED:Team.BLU;agents=Game.makeAgents(words);cards=d3.selectAll(".card").data(agents).classed("red",function(a){return a.team===Team.RED}).classed("blu",function(a){return a.team===Team.BLU}).classed("bad",function(a){return a.team===Team.BAD}).classed("flip flip2 fade",false).on("click",null);document.body.classList.remove("dead");if(Game.spymaster){cards.select(".front").text(function(a){return a.word});cards.select(".back").text("");cards.classed("flip",true);return cards.on("click",function(){return this.classList.toggle("fade")})}else{cards.select(".front").text(function(a){return Team.word(a.team)});cards.select(".back").text(function(a){return a.word});return cards.on("click",function(a){this.classList.add("flip");if(a.team===Team.BAD){return document.body.classList.add("dead")}})}})["catch"](function(err){return setTimeout(function(){throw err})})};toggleOptions=function(){return document.querySelector(".options").classList.toggle("hidden")};document.getElementById("seed").addEventListener("keydown",function(e){var key;key=e.key||e.which||e.keyCode;if(key===13||key==="Enter"){e.preventDefault();this.blur();toggleOptions();return Game.start(this.value,false)}});document.querySelector("button.join-button").addEventListener("click",function(){var seed;seed=document.getElementById("seed").value;if(seed!=null&&seed!==""){return Game.start(seed,false)}});document.querySelector("button.create-button").addEventListener("click",function(){return Game.start(null)});document.querySelector(".options-toggle").addEventListener("click",toggleOptions);document.querySelector(".card-box").addEventListener("click",function(){return document.querySelector(".options").classList.add("hidden")});Game.start(window.location.hash.slice(1),false);window.onhashchange=function(){return Game.start(window.location.hash.slice(1),false)};