var game,nextTeam,startGame,teamAtTurn,teamWord;game={starting:"nil",blu:{selections:[],points:0},red:{selections:[],points:0}};nextTeam=function(team){switch(team){case"red":return"blu";case"blu":return"red";default:throw Error("Invalid team")}};teamWord=function(team){switch(team){case"red":return"Rojo";case"blu":return"Azul";case"bad":return"Asesino";case"nil":return"Inocente";default:throw Error("Invalid team")}};teamAtTurn=function(n){if(n%2===0){return game.starting}else{return nextTeam(game.starting)}};startGame=function(){return d3.text("words/words.es.txt",function(err,text){var agent_id,agent_ids,cards,i,is_master,j,len,results,turn_number,word,words,words_raw;words_raw=d3.csvParseRows(text,function(a){return a[0]});if(window.location.hash===""){window.location.hash=d3.shuffle(words_raw).slice(0,3).map(function(str){return str.charAt(0).toUpperCase()+str.slice(1)}).join("")}Math.seedrandom(window.location.hash.toLowerCase());game.starting=Math.random()>.5?"red":"blu";words=function(){var i,len,ref,results;ref=d3.shuffle(words_raw).slice(0,25);results=[];for(i=0,len=ref.length;i<len;i++){word=ref[i];results.push({word:word,team:"nil"})}return results}();agent_ids=d3.shuffle(function(){results=[];for(i=0;i<=24;i++){results.push(i)}return results}.apply(this)).slice(0,16);for(turn_number=j=0,len=agent_ids.length;j<len;turn_number=++j){agent_id=agent_ids[turn_number];words[agent_id].team=teamAtTurn(turn_number)}words[agent_ids[15]].team="bad";cards=d3.selectAll(".card").data(words).classed("red",function(w){return w.team==="red"}).classed("blu",function(w){return w.team==="blu"}).classed("bad",function(w){return w.team==="bad"});is_master=location.search;if(is_master){cards.select(".front > .label").text(function(w){return w.word});cards.classed("flip",true)}else{cards.select(".back").text(function(w){return w.word});cards.select(".front > .label").text(function(w){return teamWord(w.team)})}return cards.on("click",function(w){return d3.select(this).classed("flip",!is_master)})})};window.onhashchange=startGame;startGame();